<form (ngSubmit)="onSubmit()" [formGroup]="form">
    <h6 class="mat-subtitle-1">Configure TOTP for {{ loginData?.loginName }}</h6>

    <ng-container *ngIf="doneLoading">
        <div class="form-content">
            <p class="mat-caption">
                Scan the QR code using your authenticator app.
            </p>

            <div style="text-align: center">
                <qrcode alt="qrcode" [qrdata]="credentialData.toUrl" [width]="100" errorCorrectionLevel="M"></qrcode>
                <span class="mat-caption">
                    {{ credentialData.secret }}
                </span>
            </div>

            <p class="mat-caption">
                After scanning, enter the verification code from your authenticator app below.
            </p>
            <mat-form-field appearance="outline">
                <mat-label>Enter code from the TOTP App...</mat-label>
                <input autofocus
                       matInput
                       formControlName="secret"
                       name="code" placeholder="Enter code from the TOTP App..." required>
                <mat-error>{{ this.errorMessageSignal() }}</mat-error>
            </mat-form-field>
        </div>

        <div class="form-footer">
            <button mat-button type="button" (click)="onCancel()">Cancel</button>
            <button mat-stroked-button type="submit">Continue</button>
        </div>
    </ng-container>

    @if (!doneLoading) {
        <p class="mat-caption">
            Requesting App token for {{ loginData?.loginName }}
        </p>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }

</form>
