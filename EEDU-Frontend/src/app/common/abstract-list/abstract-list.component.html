<mat-form-field appearance="outline" *ngIf="filteredValues.length != 0 && generalListInfo()">
    <mat-label>Search</mat-label>
    <input name="search"
           type="search"
           placeholder="Filter..."
           [(ngModel)]="filteredString"
           (input)="unselectAll()"
           autofocus matInput>
</mat-form-field>

<ng-template #ngcontent>
    <ng-content></ng-content>
</ng-template>

<div *ngIf="!hasContent">
    <mat-list>
        <all-checkbox
            [checked]="isSelected('all')"
            [indeterminate]="partiallySelected"
            (onToggle)="toggle('all')">
            <ng-container *ngTemplateOutlet="ngcontent"></ng-container>
        </all-checkbox>

        <div [style.height]="height() + 'px'" style="overflow: scroll;">
            @for (value of filteredValues; track value) {

                <mat-list-item class="selectable" >
                    <div matListItemTitle style="width: 100%; display: flex; justify-content: space-between">
                        <div>
                            <single-checkbox
                                [checked]="isSelected(value)"
                                [icon]="loadIcon(value)"
                                [title]="loadTitle(value)"
                                [show]="selectionType() === SelectionType.MULTIPLE"
                                (keyboardEvent)="handleKeyDown($event, value)"
                                (onToggle)="toggle(value)">
                            </single-checkbox>
                        </div>

                        <div>
                            <mat-chip-set *ngIf="hasChips">
                                @for (tag of loadChips(value); track tag) {
                                    <mat-chip>{{ tag }}</mat-chip>
                                }
                            </mat-chip-set>
                        </div>
                    </div>
                </mat-list-item>
            }
        </div>
    </mat-list>
</div>

<mat-accordion *ngIf="hasContent">
    <all-checkbox
        [checked]="isSelected('all')"
        [indeterminate]="partiallySelected"
        (onToggle)="toggle('all')">
        <ng-container *ngTemplateOutlet="ngcontent"></ng-container>
    </all-checkbox>
    <mat-expansion-panel *ngFor="let value of filteredValues">
        <mat-expansion-panel-header tabindex="-1">
            <mat-panel-title>
                <single-checkbox
                    [checked]="isSelected(value)" [icon]="loadIcon(value)" [title]="loadTitle(value)"
                    (keyboardEvent)="handleKeyDown($event, value)"
                    (onToggle)="toggle(value)">
                </single-checkbox>
            </mat-panel-title>
            <mat-panel-description>
                <mat-chip-set *ngIf="hasChips">
                    @for (tag of loadChips(value); track tag) { <mat-chip>{{ tag }}</mat-chip> }
                </mat-chip-set>
                <!--
                <mat-icon class="icon" *ngIf="icon">
                    {{ icon(value) }}
                </mat-icon>
                -->
            </mat-panel-description>
        </mat-expansion-panel-header>
        <ng-container *ngIf="hasContent">
            <ng-container *ngComponentOutlet="content; inputs: { entry: value }"></ng-container>
        </ng-container>
    </mat-expansion-panel>
</mat-accordion>
