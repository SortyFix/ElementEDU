<ng-container *ngIf="editing()">
    <ng-content></ng-content>
</ng-container>

<ng-container *ngIf="!editing() && assignment?.description">

    <p>
        {{ assignment?.description }}
    </p>

    <mat-form-field>
        <mat-label>Current User</mat-label>
        <mat-select #select (valueChange)="currentInsight = select.value">
            @for (insight of assignmentInsight; track assignmentInsight) {
                <mat-option [value]="insight">
                    <mat-icon>{{ toIcon(insight) }}</mat-icon>
                    {{ insight.user.name }}
                </mat-option>
            }
        </mat-select>
    </mat-form-field>

    <ng-container *ngIf="currentInsight != null">

        <div *ngIf="currentInsight.submitted">
            <form [formGroup]="assessForm" (ngSubmit)="onAssess()">
                <ul>
                    @for (file of currentInsight.files; track file) {
                        <li>{{ file }}</li>
                    }
                </ul>

                <div *ngIf="currentInsight.assessment === null">
                    <mat-form-field>
                        <mat-label>Feedback</mat-label>
                        <textarea
                            matInput
                            formControlName="feedback"
                            placeholder="Enter the feedback you would wish to share with the student">
                    </textarea>
                    </mat-form-field>
                    <button mat-button color="primary" type="submit">Assess</button>
                </div>

                <div *ngIf="currentInsight.assessment !== null">
                    <p>{{ currentInsight.assessment.feedback }}</p>
                </div>

            </form>
        </div>

        <div *ngIf="!currentInsight.submitted">
            <general-error-box
                [icon]="toIcon(currentInsight)"
                message="Nothing has been submitted."
                [subMessage]="'The user ' + currentInsight.user.name + ' has not submitted anything yet'">
            </general-error-box>
        </div>
    </ng-container>
</ng-container>
