<form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-card>
        <mat-card-header>
            <mat-card-title>{{ title() }}</mat-card-title>
            <mat-card-subtitle>{{ subtitle() }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
            <div class="data-container">
                <mat-grid-list cols="6" rowHeight="150px" gutterSize="5px">

                    <!-- Description -->
                    <mat-grid-tile rowspan="2" colspan="3">
                        <mat-card>
                            <mat-card-header class="container-header">
                                <mat-card-subtitle>Description</mat-card-subtitle>
                                <button mat-icon-button type="button" (click)="switchEdit = 'description'">
                                    <mat-icon>{{ isEditing('description') ? 'check' : 'edit' }}</mat-icon>
                                </button>
                            </mat-card-header>
                            <mat-card-content [style.overflow]="enableScroll">
                                @if (isEditing('description')) {
                                    <mat-form-field class="form-field" appearance="outline">
                                        <textarea
                                            matInput
                                            style="height: 180px;"
                                            formControlName="description"
                                            maxlength="1000"
                                            #descriptionInput></textarea>
                                        <mat-hint align="end">{{descriptionInput.textLength }}/1000</mat-hint>
                                    </mat-form-field>
                                } @else {
                                    <div class="description-content">
                                        {{ this.form.get('description')?.value || 'No description provided for this appointment' }}
                                    </div>
                                }
                            </mat-card-content>
                        </mat-card>
                    </mat-grid-tile>

                    <!-- Assignments -->
                    <mat-grid-tile rowspan="3" colspan="3">
                        <mat-card>
                            <mat-card-header>
                                <mat-card-subtitle>Assignment</mat-card-subtitle>
                                <button mat-icon-button type="button" (click)="switchEdit = 'assignment'">
                                    <mat-icon>{{ isEditing('assignment') ? 'check' : 'edit' }}</mat-icon>
                                </button>
                            </mat-card-header>
                            <mat-card-content>
                                @if (isEditing('assignment')) {
                                    <mat-form-field appearance="outline" class="form-field">
                                        <textarea matInput style="height: 120px;" formControlName="assignment"></textarea>
                                    </mat-form-field>
                                    @if (this.form.get('assignment')?.value) {
                                        <app-date-time-picker label="publish" formControlName="publish"></app-date-time-picker>
                                        <app-date-time-picker label="deadline" formControlName="submitUntil"></app-date-time-picker>
                                    }
                                } @else {
                                    {{ form.get('assignment')?.value || 'No assignment given' }}

                                    @if (form.get('assignment')?.value)
                                    {
                                        <mat-list>
                                            <mat-list-item>
                                                <span matListItemTitle>Deadline:</span>
                                                <span matListItemLine>{{ form.get('submitUntil')?.value }}</span>
                                            </mat-list-item>
                                            <mat-list-item>
                                                <span matListItemTitle>Submitted:</span>
                                                <span matListItemLine>not yet</span>
                                            </mat-list-item>
                                        </mat-list>
                                        <div class="assignment-drop">
                                            <input type="file" #fileDropRef multiple>
                                            <mat-icon>upload</mat-icon>
                                            <h3>Drag and drop file here</h3>
                                            <h3>or</h3>
                                            <label [for]="fileDropRef">Browse for file</label>
                                        </div>
                                    }
                                }

                            </mat-card-content>
                        </mat-card>
                    </mat-grid-tile>

                    <!-- Room -->
                    <mat-grid-tile rowspan="1" colspan="2">
                        <mat-card>
                            <mat-card-header>
                                <mat-card-subtitle>Room</mat-card-subtitle>
                                <button mat-icon-button type="button" (click)="switchEdit = 'room'">
                                    <mat-icon>{{ isEditing('room') ? 'check' : 'edit' }}</mat-icon>
                                </button>
                            </mat-card-header>
                            <mat-card-content>
                                @if(isEditing('room'))
                                {
                                    <app-general-selection-input
                                        class="form-field"
                                        [label]="null"
                                        placeholder="Enter the room you wish to set this to"
                                        [values]="rooms"
                                        formControlName="room">
                                    </app-general-selection-input>
                                }
                                @else {
                                    {{ formRoom?.name || 'No room specified' }}
                                }
                            </mat-card-content>
                        </mat-card>
                    </mat-grid-tile>

                    <mat-grid-tile rowspan="1" colspan="1">
                        <mat-card>
                            <mat-card-header>
                                <mat-card-subtitle>Resources</mat-card-subtitle>
                            </mat-card-header>
                            <mat-card-content style="text-align: center">
                                <mat-icon>upload_file</mat-icon>
                            </mat-card-content>
                        </mat-card>
                    </mat-grid-tile>
                </mat-grid-list>
            </div>
        </mat-card-content>
        <mat-card-actions style="display: flex; justify-content: space-between" *ngIf="anyEdit">
            <p style="background-color: #ceb986; margin: 5px 15px 5px 5px; padding: 5px; border-radius: 8px;">You have got unsaved changes. Press "Save Changes" to save your changes.</p>
            <button mat-flat-button type="submit" [disabled]="isCurrentlyEditing">Save Changes</button>
        </mat-card-actions>
    </mat-card>
</form>

